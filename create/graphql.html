<!DOCTYPE html>
<html lang="English">
  <head>
    <title>GraphQL Schema | SubQuery Guide</title><meta name="description" content="SubQuery is a open-source tool to provide a complete process and query data solution to every substrate project and will become core infrastructure for the Polkadot ecosystem."><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="VuePress 2.0.0-beta.10">
    <link rel="preload" href="/assets/js/runtime~app.9955d945.js" as="script"><link rel="preload" href="/assets/css/styles.5ae7cc2e.css" as="style"><link rel="preload" href="/assets/js/413.ec21ad29.js" as="script"><link rel="preload" href="/assets/js/app.9eb460aa.js" as="script">
    <link rel="stylesheet" href="/assets/css/styles.5ae7cc2e.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><header class="navbar"><div class="toggle-sidebar-button"><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class=""></path></svg></div><span><a href="/" class=""><img class="logo" src="/assets/img/logo.png" alt="SubQuery Guide"><span class="site-name can-hide">SubQuery Guide</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a class="nav-link external" href="https://explorer.subquery.network/" rel="noopener noreferrer" target="_blank" aria-label="Explorer"><!--[--><!--]--> Explorer <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://project.subquery.network/" rel="noopener noreferrer" target="_blank" aria-label="Projects"><!--[--><!--]--> Projects <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="Documentation"><!--[--><!--]--> Documentation <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/subquery/subql" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><!----></div></header><div class="sidebar-mask"></div><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a class="nav-link external" href="https://explorer.subquery.network/" rel="noopener noreferrer" target="_blank" aria-label="Explorer"><!--[--><!--]--> Explorer <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://project.subquery.network/" rel="noopener noreferrer" target="_blank" aria-label="Projects"><!--[--><!--]--> Projects <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="navbar-links-item"><a href="/" class="nav-link" aria-label="Documentation"><!--[--><!--]--> Documentation <!--[--><!--]--></a></div><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/subquery/subql" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><a href="/" class="nav-link sidebar-link" aria-label="Welcome to SubQuery!"><!--[--><!--]--> Welcome to SubQuery! <!--[--><!--]--></a><!----><!--]--><!--[--><a href="/quickstart.html" class="nav-link sidebar-link" aria-label="Quick Start Guide"><!--[--><!--]--> Quick Start Guide <!--[--><!--]--></a><!----><!--]--><!--[--><section class="sidebar-group"><a href="/create/introduction.md" class="nav-link sidebar-heading active" aria-label="Create a Project"><!--[--><!--]--> Create a Project <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/create/introduction.html" class="nav-link sidebar-link" aria-label="Creating a SubQuery Project"><!--[--><!--]--> Creating a SubQuery Project <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/create/manifest.html" class="nav-link sidebar-link" aria-label="Manifest File"><!--[--><!--]--> Manifest File <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/create/graphql.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-link active" aria-label="GraphQL Schema"><!--[--><!--]--> GraphQL Schema <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/create/graphql.html#defining-entities" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Defining Entities"><!--[--><!--]--> Defining Entities <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/create/graphql.html#entites" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Entites"><!--[--><!--]--> Entites <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/create/graphql.html#supported-scalars-and-types" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Supported scalars and types"><!--[--><!--]--> Supported scalars and types <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/create/graphql.html#indexing-by-non-primary-key-field" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Indexing by Non-primary-key field"><!--[--><!--]--> Indexing by Non-primary-key field <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/create/graphql.html#entity-relationships" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Entity Relationships"><!--[--><!--]--> Entity Relationships <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/create/graphql.html#one-to-one-relationships" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="One-to-One Relationships"><!--[--><!--]--> One-to-One Relationships <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/create/graphql.html#one-to-many-relationships" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="One-to-Many relationships"><!--[--><!--]--> One-to-Many relationships <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/create/graphql.html#many-to-many-relationships" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Many-to-Many relationships"><!--[--><!--]--> Many-to-Many relationships <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/create/graphql.html#reverse-lookups" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Reverse Lookups"><!--[--><!--]--> Reverse Lookups <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/create/graphql.html#json-type" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="JSON type"><!--[--><!--]--> JSON type <!--[--><!--]--></a><ul class="sidebar-sub-headers"><li><!--[--><a aria-current="page" href="/create/graphql.html#define-json-directive" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Define JSON directive"><!--[--><!--]--> Define JSON directive <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/create/graphql.html#querying-json-field" class="router-link-active router-link-exact-active nav-link sidebar-link" aria-label="Querying JSON field"><!--[--><!--]--> Querying JSON field <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li></ul><!--]--></li><li><!--[--><a href="/create/mapping.html" class="nav-link sidebar-link" aria-label="Mapping"><!--[--><!--]--> Mapping <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--[--><section class="sidebar-group"><a href="/run/indexing_query.md" class="nav-link sidebar-heading" aria-label="Run a Project"><!--[--><!--]--> Run a Project <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/run/indexing_query.html" class="nav-link sidebar-link" aria-label="Indexing and Query"><!--[--><!--]--> Indexing and Query <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/run/sandbox.html" class="nav-link sidebar-link" aria-label="The Sandbox"><!--[--><!--]--> The Sandbox <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--[--><section class="sidebar-group"><a href="/publish/publish.md" class="nav-link sidebar-heading" aria-label="Publish a Project"><!--[--><!--]--> Publish a Project <!--[--><!--]--></a><ul class=""><li><!--[--><a href="/publish/publish.html" class="nav-link sidebar-link" aria-label="Publish your SubQuery Project"><!--[--><!--]--> Publish your SubQuery Project <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/publish/upgrade.html" class="nav-link sidebar-link" aria-label="Deploy a New Version of your SubQuery Project"><!--[--><!--]--> Deploy a New Version of your SubQuery Project <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/publish/connect.html" class="nav-link sidebar-link" aria-label="Connect to your New Project"><!--[--><!--]--> Connect to your New Project <!--[--><!--]--></a><!----><!--]--></li></ul></section><!--]--><!--]--></ul><!--[--><!--]--></aside><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="graphql-schema"><a class="header-anchor" href="#graphql-schema">#</a> GraphQL Schema</h1><h2 id="defining-entities"><a class="header-anchor" href="#defining-entities">#</a> Defining Entities</h2><p>The <code>schema.graphql</code> file defines the various GraphQL schemas. Due to the way that the GraphQL query language works, the schema file essentially dictates the shape of your data from SubQuery. To learn more about how writing in GraphQL schema language, we recommend checking out on <a href="https://graphql.org/learn/schema/#type-language" target="_blank" rel="noopener noreferrer">Schemas and Types<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" ariahidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>.</p><p><strong>Important: When you make any changes to the schema file please ensure that you regenerate your types directory with the following command <code>yarn codegen</code></strong></p><h3 id="entites"><a class="header-anchor" href="#entites">#</a> Entites</h3><p>Each entity must define its required fields <code>id</code> with the type of <code>ID!</code>, it used as the primary key and unique among all entities of the same type.</p><p>Non nullable fields in the entity are indicated by <code>!</code>. Please see the example below:</p><div class="language-graphql ext-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Example</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span> <span class="token comment"># id field is always required and must look like this</span>
  <span class="token attr-name">name</span><span class="token punctuation">:</span> String<span class="token operator">!</span> <span class="token comment"># This is a required field</span>
  <span class="token attr-name">address</span><span class="token punctuation">:</span> String <span class="token comment"># This is an optional field</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>Important: When you make any changes to the schema file please ensure that you regenerate your types directory with the following command <code>yarn codegen</code></strong></p><h3 id="supported-scalars-and-types"><a class="header-anchor" href="#supported-scalars-and-types">#</a> Supported scalars and types</h3><p>We currently supporting flowing scalars types:</p><ul><li><code>ID</code></li><li><code>Int</code></li><li><code>String</code></li><li><code>BigInt</code></li><li><code>Date</code></li><li><code>Boolean</code></li><li><code>&lt;EntityName&gt;</code> for nested relationship entities, you might use the defined entity&#39;s name as one of the fields. Please see in <a href="#entity-relationships">Entity Relationships</a>.</li><li><code>JSON</code> can alternatively store structured data, please see <a href="#json-type">JSON type</a></li></ul><h2 id="indexing-by-non-primary-key-field"><a class="header-anchor" href="#indexing-by-non-primary-key-field">#</a> Indexing by Non-primary-key field</h2><p>To improve query performance, index an entity field simply by implement the <code>@index</code> annotation on a non-primary-key field.</p><p>We don&#39;t allow user to add <code>@index</code> annotation on any <a href="#json-type">JSON</a> object. By default, indexes automatically added for JSON fields in the database, but only for enhance query service performance purpose.</p><p>Here is an example.</p><div class="language-graphql ext-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">User</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">name</span><span class="token punctuation">:</span> String<span class="token operator">!</span> <span class="token directive function">@index</span><span class="token punctuation">(</span><span class="token attr-name">unique</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment"># unique can be set to true or false</span>
  <span class="token attr-name">title</span><span class="token punctuation">:</span> Title<span class="token operator">!</span> <span class="token directive function">@index</span> <span class="token comment"># By default indexes are not unique, index by foreign key field </span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Title</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>  
  <span class="token attr-name">name</span><span class="token punctuation">:</span> String<span class="token operator">!</span> <span class="token directive function">@index</span><span class="token punctuation">(</span><span class="token attr-name">unique</span><span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>Assuming we knew this user&#39;s name, but we don&#39;t know the exact id value, rather than extract all users and then filtering by name we can add <code>@index</code> behind the name field. This makes querying much faster and we can additionally pass the <code>unique: true</code> to ensure uniqueness.</p><p><strong>If a field is not unique, the maximum result set size is 100</strong></p><p>When code generation is run, this will automatically create a <code>getByName</code> under the <code>User</code> model, and The foreign key field <code>title</code> will create a <code>getByTitleId</code> method, which both can directly be accessed in the mapping function.</p><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code><span class="token comment">/* Prepare a record for title entity */</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> titles <span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">&#39;id_1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Captain&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-typescript ext-ts line-numbers-mode"><pre class="language-typescript"><code><span class="token comment">// Handler in mapping function</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>User<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../types/models/User&quot;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>Title<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../types/models/Title&quot;</span>

<span class="token keyword">const</span> jack <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">&#39;Jack Sparrow&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> captainTitle <span class="token operator">=</span> <span class="token keyword">await</span> Title<span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span><span class="token string">&#39;Captain&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> pirateLords <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">getByTitleId</span><span class="token punctuation">(</span>captainTitle<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// List of all Captains</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="entity-relationships"><a class="header-anchor" href="#entity-relationships">#</a> Entity Relationships</h2><p>An entity often has nested relationships with other entities. Set the field value to another entity name will define a one-to-one relationship between these two entities by default.</p><p>Different entity relationships (one-to-one, one-to-many, and many-to-many) can be configured using the examples below</p><h3 id="one-to-one-relationships"><a class="header-anchor" href="#one-to-one-relationships">#</a> One-to-One Relationships</h3><p>One-to-one relationships are by default when only a single entity is mapped to another</p><p>Exmaple: A Passport will only have one person and a person only has one passport (in this example):</p><div class="language-graphql ext-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Passport</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">owner</span><span class="token punctuation">:</span> Person<span class="token operator">!</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>or</p><div class="language-graphql ext-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">passport</span><span class="token punctuation">:</span> Passport<span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Passport</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">owner</span><span class="token punctuation">:</span> Person<span class="token operator">!</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="one-to-many-relationships"><a class="header-anchor" href="#one-to-many-relationships">#</a> One-to-Many relationships</h3><p>You cna use brackets to indicate that a field type includes multiple entities</p><p>Example: A person can have multipe accounts</p><div class="language-graphql ext-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">accounts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Account<span class="token punctuation">]</span> 
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Account</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">publicAddress</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="many-to-many-relationships"><a class="header-anchor" href="#many-to-many-relationships">#</a> Many-to-Many relationships</h3><p>A many-to-Many relationship can be achieved by implementing a mapping entity to connect the other two entities.</p><p>Example: Each person is a part of multiple groups and groups have multiple different people</p><div class="language-graphql ext-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">name</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
  <span class="token attr-name">groups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>PersonGroup<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">PersonGroup</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">person</span><span class="token punctuation">:</span> Person<span class="token operator">!</span>
  <span class="token attr-name">Group</span><span class="token punctuation">:</span> Group<span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Group</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">name</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
  <span class="token attr-name">persons</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>PersonGroup<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>Also, it is possible to create a connection of the same entity in multiple fields of the middle entity.</p><p>Example, an account can have multiple transfers, and each transfer has a source and destination account.</p><p>This will establish a bidirectional relationship between two Accounts (from and to) through Transfer table.</p><div class="language-graphql ext-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Account</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">publicAddress</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Transfer</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">amount</span><span class="token punctuation">:</span> BigInt
  <span class="token attr-name">from</span><span class="token punctuation">:</span> Account<span class="token operator">!</span>
  <span class="token attr-name">to</span><span class="token punctuation">:</span> Account<span class="token operator">!</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="reverse-lookups"><a class="header-anchor" href="#reverse-lookups">#</a> Reverse Lookups</h3><p>To enable reverse lookup on an entity to a relation, attach <code>@derivedFrom</code> to the field and point to its reverse lookup field of another entity.</p><p>This create a virtual field on the entity that can be queried.</p><p>The Transfer from an account accessible from the Account by deriving a transfers field:</p><div class="language-graphql ext-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">Account</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">publicAddress</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
  <span class="token attr-name">sentTransfers</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Transfer<span class="token punctuation">]</span> <span class="token directive function">@derivedFrom</span><span class="token punctuation">(</span><span class="token attr-name">field</span><span class="token punctuation">:</span> <span class="token string">&quot;from&quot;</span><span class="token punctuation">)</span>
  <span class="token attr-name">recievedTransfers</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>Transfer<span class="token punctuation">]</span> <span class="token directive function">@derivedFrom</span><span class="token punctuation">(</span><span class="token attr-name">field</span><span class="token punctuation">:</span> <span class="token string">&quot;to&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">Transfer</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span>
  <span class="token attr-name">amount</span><span class="token punctuation">:</span> BigInt
  <span class="token attr-name">from</span><span class="token punctuation">:</span> Account<span class="token operator">!</span>
  <span class="token attr-name">to</span><span class="token punctuation">:</span> Account<span class="token operator">!</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="json-type"><a class="header-anchor" href="#json-type">#</a> JSON type</h2><p>We are supporting saving data as a JSON type, which is a fast way to store structured data. We&#39;ll automatically generate corresponding JSON interfaces for querying this data and save you time defining and managing entities.</p><p>We recommend users use the JSON type in the following scenarios:</p><ul><li>When storing structured data in a single field is more manageable than creating multiple separate entities.</li><li>Saving arbitrary key/value user preferences (where the value can be boolean, textual, or numeric, and you don&#39;t want to have separate columns for different data types)</li><li>The schema is volatile and change frequently</li></ul><h3 id="define-json-directive"><a class="header-anchor" href="#define-json-directive">#</a> Define JSON directive</h3><p>Define the propery as a JSON type by adding the <code>jsonField</code> annotation in the entity, this will automatically generate interfaces for all JSON objects in your project under <code>types/interfaces.ts</code>, and you can access them in your mapping function.</p><p>Unlike the entity, the jsonField directive object does not require any <code>id</code> field. A JSON object is also able to nest with other JSON objects.</p><div class="language-graphql ext-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token keyword">type</span> <span class="token class-name">AddressDetail</span> <span class="token directive function">@jsonField</span> <span class="token punctuation">{</span>
  <span class="token attr-name">street</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
  <span class="token attr-name">district</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">ContactCard</span> <span class="token directive function">@jsonField</span> <span class="token punctuation">{</span>
  <span class="token attr-name">phone</span><span class="token punctuation">:</span> String<span class="token operator">!</span>
  <span class="token attr-name">address</span><span class="token punctuation">:</span> AddressDetail <span class="token comment"># Nested JSON</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> <span class="token class-name">User</span> <span class="token directive function">@entity</span> <span class="token punctuation">{</span>
  <span class="token attr-name">id</span><span class="token punctuation">:</span> ID<span class="token operator">!</span> 
  <span class="token attr-name">contact</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>ContactCard<span class="token punctuation">]</span> <span class="token comment"># Store a list of JSON objects</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="querying-json-field"><a class="header-anchor" href="#querying-json-field">#</a> Querying JSON field</h3><p>The drawback of using JSON types is a slight impact on query efficiency when filtering since each time it performs a text search on the entire entity.</p><p>However, the impact is still acceptable in our query service. Here is an example of how to use the <code>contains</code> operator in the GraphQL query on a JSON field to find the the first 5 users own phone numbers contains &#39;0064&#39;.</p><div class="language-graphql ext-graphql line-numbers-mode"><pre class="language-graphql"><code><span class="token comment">#To find the the first 5 users own phone numbers contains &#39;0064&#39;.</span>

<span class="token keyword">query</span><span class="token punctuation">{</span>
  user<span class="token punctuation">(</span>
    <span class="token attr-name">first</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token attr-name">filter</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token attr-name">contactCard</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token attr-name">contains</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token attr-name">phone</span><span class="token punctuation">:</span> <span class="token string">&quot;0064&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    nodes<span class="token punctuation">{</span>
      id
      contactCard
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><span class="meta-item-info">5/14/2021, 4:35:52 AM</span></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"> ← <a href="/create/manifest.html" class="nav-link" aria-label="Manifest File"><!--[--><!--]--> Manifest File <!--[--><!--]--></a></span><span class="next"><a href="/create/mapping.html" class="nav-link" aria-label="Mapping"><!--[--><!--]--> Mapping <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main></div><!----><!--]--></div>
    <script src="/assets/js/runtime~app.9955d945.js" defer></script><script src="/assets/js/413.ec21ad29.js" defer></script><script src="/assets/js/app.9eb460aa.js" defer></script>
  </body>
</html>
