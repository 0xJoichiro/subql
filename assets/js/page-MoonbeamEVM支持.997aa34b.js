(window.webpackJsonp=window.webpackJsonp||[]).push([[111],{875:function(t,e,s){"use strict";s.r(e);var a=s(1),r=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"moonbeam-evm-支持"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#moonbeam-evm-支持"}},[t._v("#")]),t._v(" Moonbeam EVM 支持")]),t._v(" "),s("p",[t._v("我们为Moonbeam和Moonriver的EVM提供了一个自定义数据源处理器。 这提供了一种简单的方法来筛选和索引月球网络上的 EVM 和 Substrate 活动在一个单一的 SubQuery 项目中。")]),t._v(" "),s("p",[t._v("支持的网络：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("网络名称")]),t._v(" "),s("th",[t._v("Websocket 端点")]),t._v(" "),s("th",[t._v("Dictionary 端点")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("Moonbeam")]),t._v(" "),s("td",[s("em",[t._v("Coming soon")])]),t._v(" "),s("td",[s("em",[t._v("Coming soon")])])]),t._v(" "),s("tr",[s("td",[t._v("Moonriver")]),t._v(" "),s("td",[s("code",[t._v("wss://moonbeam-alpha.api.onfinality.io/public-ws")])]),t._v(" "),s("td",[s("code",[t._v("https://api.subquery.network/sq/subquery/moonriver-dictionary")])])]),t._v(" "),s("tr",[s("td",[t._v("Moonbase Alpha")]),t._v(" "),s("td",[s("code",[t._v("wss://moonriver.api.onfinality.io/public-ws")])]),t._v(" "),s("td",[s("code",[t._v("https://api.subquery.network/sq/subquery/moonbase-alpha-dictionary")])])])])]),t._v(" "),s("p",[s("strong",[t._v("您也可以通过事件和调用处理程序来参考 "),s("a",{attrs:{href:"https://github.com/subquery/tutorials-moonriver-evm-starter",target:"_blank",rel:"noopener noreferrer"}},[t._v("基本Moonrier EVM 示例项目"),s("OutboundLink")],1)]),t._v(" 这个项目也存在于 "),s("a",{attrs:{href:"https://explorer.subquery.network/subquery/subquery/moonriver-evm-starter-project",target:"_blank",rel:"noopener noreferrer"}},[t._v(" SubQuery Explorer"),s("OutboundLink")],1),t._v(" 中。")]),t._v(" "),s("h2",{attrs:{id:"入门指南"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#入门指南"}},[t._v("#")]),t._v(" 入门指南")]),t._v(" "),s("ol",[s("li",[t._v("添加自定义数据源作为依赖项 "),s("code",[t._v("yarn 添加 @subql/contract-processors")])]),t._v(" "),s("li",[t._v("添加自定义数据源，如下文所述。")]),t._v(" "),s("li",[t._v("将自定义数据源的处理程序添加到您的代码")])]),t._v(" "),s("h2",{attrs:{id:"datasource-说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#datasource-说明"}},[t._v("#")]),t._v(" Datasource 说明")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Field")]),t._v(" "),s("th",[t._v("Type")]),t._v(" "),s("th",[t._v("Required")]),t._v(" "),s("th",[t._v("Description")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("processor.file")]),t._v(" "),s("td",[s("code",[t._v("'./node_modules/@subql/contract-processors/dist/moonbeam.js'")])]),t._v(" "),s("td",[t._v("Yes")]),t._v(" "),s("td",[t._v("File reference to the data processor code")])]),t._v(" "),s("tr",[s("td",[t._v("processor.options")]),t._v(" "),s("td",[s("a",{attrs:{href:"#processor-options"}},[t._v("ProcessorOptions")])]),t._v(" "),s("td",[t._v("No")]),t._v(" "),s("td",[t._v("Options specific to the Moonbeam Processor")])]),t._v(" "),s("tr",[s("td",[t._v("assets")]),t._v(" "),s("td",[s("code",[t._v("{ [key: String]: { file: String }}")])]),t._v(" "),s("td",[t._v("No")]),t._v(" "),s("td",[t._v("An object of external asset files")])])])]),t._v(" "),s("h3",{attrs:{id:"处理器选项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#处理器选项"}},[t._v("#")]),t._v(" 处理器选项：")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Field")]),t._v(" "),s("th",[t._v("Type")]),t._v(" "),s("th",[t._v("Required")]),t._v(" "),s("th",[t._v("Description")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("abi")]),t._v(" "),s("td",[t._v("String")]),t._v(" "),s("td",[t._v("No")]),t._v(" "),s("td",[t._v("处理器使用的 ABI 解析参数。 MUST 是 "),s("code",[t._v("asset的一个密钥")])])]),t._v(" "),s("tr",[s("td",[t._v("address")]),t._v(" "),s("td",[t._v("String or "),s("code",[t._v("null")])]),t._v(" "),s("td",[t._v("No")]),t._v(" "),s("td",[t._v("事件发生或呼叫的合同地址。 "),s("code",[t._v("null")]),t._v(" 将捕获合同创建调用")])])])]),t._v(" "),s("h2",{attrs:{id:"moonbeamcall"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#moonbeamcall"}},[t._v("#")]),t._v(" MoonbeamCall")]),t._v(" "),s("p",[t._v("使用 "),s("RouterLink",{attrs:{to:"/zh/create/mapping/#call-handler"}},[t._v("Substrate/CallHandler")]),t._v(" 的同样方式，但不同的处理程序参数和较小的过滤更改。")],1),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Field")]),t._v(" "),s("th",[t._v("Type")]),t._v(" "),s("th",[t._v("Required")]),t._v(" "),s("th",[t._v("Description")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("kind")]),t._v(" "),s("td",[t._v("'substrate/MoonbeamCall'")]),t._v(" "),s("td",[t._v("Yes")]),t._v(" "),s("td",[t._v("指定这是通话类型处理程序")])]),t._v(" "),s("tr",[s("td",[t._v("filter")]),t._v(" "),s("td",[s("a",{attrs:{href:"#call-filters"}},[t._v("Call Filter")])]),t._v(" "),s("td",[t._v("No")]),t._v(" "),s("td",[t._v("筛选要执行的数据源")])])])]),t._v(" "),s("h3",{attrs:{id:"通话过滤器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通话过滤器"}},[t._v("#")]),t._v(" 通话过滤器")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Field")]),t._v(" "),s("th",[t._v("Type")]),t._v(" "),s("th",[t._v("Example(s)")]),t._v(" "),s("th",[t._v("Description")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("function")]),t._v(" "),s("td",[t._v("String")]),t._v(" "),s("td",[t._v("0x095ea7b3, approve(address to,uint256 value)")]),t._v(" "),s("td",[s("a",{attrs:{href:"https://docs.ethers.io/v5/api/utils/abi/fragments/#FunctionFragment",target:"_blank",rel:"noopener noreferrer"}},[t._v("函数签名"),s("OutboundLink")],1),t._v(" 字符串或函数 "),s("code",[t._v("视野")]),t._v(" 过滤被调用的函数。")])]),t._v(" "),s("tr",[s("td",[t._v("from")]),t._v(" "),s("td",[t._v("String")]),t._v(" "),s("td",[t._v("0x6bd193ee6d2104f14f94e2ca6efefae561a4334b")]),t._v(" "),s("td",[t._v("发送交易的 Ethereum 地址")])])])]),t._v(" "),s("h3",{attrs:{id:"处理程序"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#处理程序"}},[t._v("#")]),t._v(" 处理程序")]),t._v(" "),s("p",[t._v("与正常处理程序不同的是，你不会获得一个 "),s("code",[t._v("SubstrateExtrinsic")]),t._v(" 作为参数， 相反，您将得到一个 "),s("code",[t._v("月球通话")]),t._v(" 基于Ethers "),s("a",{attrs:{href:"https://docs.ethers.io/v5/api/providers/types/#providers-TransactionResponse",target:"_blank",rel:"noopener noreferrer"}},[t._v("交易响应"),s("OutboundLink")],1),t._v(" 类型。")]),t._v(" "),s("p",[t._v("从 "),s("code",[t._v("交易响应")]),t._v(" 类型的更改：")]),t._v(" "),s("ul",[s("li",[t._v("它没有 "),s("code",[t._v("等待")]),t._v(" 和 "),s("code",[t._v("确认")]),t._v(" 属性")]),t._v(" "),s("li",[t._v("一个 "),s("code",[t._v("成功")]),t._v(" 属性被添加到知道交易是否成功")]),t._v(" "),s("li",[s("code",[t._v("args")]),t._v(" 是在提供 "),s("code",[t._v("abi")]),t._v(" 字段且参数可以成功分析时被添加")])]),t._v(" "),s("h2",{attrs:{id:"moonbeam-事件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#moonbeam-事件"}},[t._v("#")]),t._v(" Moonbeam 事件")]),t._v(" "),s("p",[t._v("使用 "),s("RouterLink",{attrs:{to:"/zh/create/mapping/#event-handler"}},[t._v("Substrate/CallHandler")]),t._v(" 的同样方式，但不同的处理程序参数和较小的过滤更改。")],1),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Field")]),t._v(" "),s("th",[t._v("Type")]),t._v(" "),s("th",[t._v("Required")]),t._v(" "),s("th",[t._v("Description")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("kind")]),t._v(" "),s("td",[t._v("'substrate/MoonbeamEvent'")]),t._v(" "),s("td",[t._v("Yes")]),t._v(" "),s("td",[t._v("指定这是通话类型处理程序")])]),t._v(" "),s("tr",[s("td",[t._v("filter")]),t._v(" "),s("td",[s("a",{attrs:{href:"#event-filters"}},[t._v("Event Filter")])]),t._v(" "),s("td",[t._v("No")]),t._v(" "),s("td",[t._v("筛选要执行的数据源")])])])]),t._v(" "),s("h3",{attrs:{id:"事件过滤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事件过滤"}},[t._v("#")]),t._v(" 事件过滤")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Field")]),t._v(" "),s("th",[t._v("Type")]),t._v(" "),s("th",[t._v("Example(s)")]),t._v(" "),s("th",[t._v("Description")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("topics")]),t._v(" "),s("td",[t._v("String array")]),t._v(" "),s("td",[t._v("Transfer(address indexed from,address indexed to,u256 value)")]),t._v(" "),s("td",[t._v("主题筛选器遵循Etherum JSON-PRC 日志过滤器，在这里可以找到更多文档 "),s("a",{attrs:{href:"https://docs.ethers.io/v5/concepts/events/",target:"_blank",rel:"noopener noreferrer"}},[s("OutboundLink")],1),t._v("。")])])])]),t._v(" "),s("p",[s("b",[t._v("关于主题的说明：")]),t._v("\n基本日志过滤器有一些改进：")]),t._v(" "),s("ul",[s("li",[t._v("主题不需要为 0 padded")]),t._v(" "),s("li",[s("a",{attrs:{href:"https://docs.ethers.io/v5/api/utils/abi/fragments/#EventFragment",target:"_blank",rel:"noopener noreferrer"}},[t._v("事件片段"),s("OutboundLink")],1),t._v(" 字符串可以提供并自动转换为他们的 id")])]),t._v(" "),s("h3",{attrs:{id:"处理程序-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#处理程序-2"}},[t._v("#")]),t._v(" 处理程序")]),t._v(" "),s("p",[t._v("与正常处理程序不同的是，你不会获得一个 "),s("code",[t._v("SubstrateExtrinsic")]),t._v(" 作为参数， 相反，您将得到一个 "),s("code",[t._v("月球通话")]),t._v(" 基于Ethers "),s("a",{attrs:{href:"https://docs.ethers.io/v5/api/providers/types/#providers-Log",target:"_blank",rel:"noopener noreferrer"}},[t._v("交易响应"),s("OutboundLink")],1),t._v(" 类型。")]),t._v(" "),s("p",[t._v("来自 "),s("code",[t._v("日志")]),t._v(" 类型的更改：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("args")]),t._v(" 是在提供 "),s("code",[t._v("abi")]),t._v(" 字段且参数可以成功分析时被添加")])]),t._v(" "),s("h2",{attrs:{id:"数据源示例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数据源示例"}},[t._v("#")]),t._v(" 数据源示例")]),t._v(" "),s("p",[t._v("这是从 "),s("code",[t._v("project.yaml")]),t._v(" 清单文件中提要。")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dataSources")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" substrate/Moonbeam\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("startBlock")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("752073")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("processor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./node_modules/@subql/contract-processors/dist/moonbeam.js'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Must be a key of assets")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("abi")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" erc20\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Contract address (or recipient if transfer) to filter, if `null` should be for contract creation")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0x6bd193ee6d2104f14f94e2ca6efefae561a4334b'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("assets")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("erc20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./erc20.abi.json'")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./dist/index.js'")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("handlers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("handler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" handleMoonriverEvent\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" substrate/MoonbeamEvent\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("topics")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Transfer(address indexed from"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("address indexed to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("u256 value)\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("handler")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" handleMoonriverCall\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" substrate/MoonbeamCall\n          "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## The function can either be the function fragment or signature")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# function: '0x095ea7b3'")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# function: '0x7ff36ab500000000000000000000000000000000000000000000000000000000'")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# function: approve(address,uint256)")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" approve(address to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("uint256 value)\n            "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0x6bd193ee6d2104f14f94e2ca6efefae561a4334b'")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br")])]),s("h2",{attrs:{id:"已知的限制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#已知的限制"}},[t._v("#")]),t._v(" 已知的限制")]),t._v(" "),s("ul",[s("li",[t._v("目前无法在处理程序中查询 EVM 状态")]),t._v(" "),s("li",[t._v("无法通过通话处理方式获取交易收据信息")]),t._v(" "),s("li",[s("code",[t._v("区块哈希")]),t._v(" 属性当前未定义。 "),s("code",[t._v("区块编号")]),t._v(" 属性可以改为使用")])])])}),[],!1,null,null,null);e.default=r.exports}}]);