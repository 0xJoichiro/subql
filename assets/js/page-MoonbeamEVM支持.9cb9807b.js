(window.webpackJsonp=window.webpackJsonp||[]).push([[118],{971:function(t,e,a){"use strict";a.r(e);var s=a(1),r=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"moonbeam-evm-支持"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#moonbeam-evm-支持"}},[t._v("#")]),t._v(" Moonbeam EVM 支持")]),t._v(" "),a("p",[t._v("我们为Moonbeam和Moonriver的EVM提供了一个自定义数据源处理器。 这为单一的 SubQuery 项目中提供了一种简单的方法来筛选和索引Moonbeam的网络上的 EVM 和 底层活动。")]),t._v(" "),a("p",[t._v("支持的网络：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("网络名称")]),t._v(" "),a("th",[t._v("Websocket 终端")]),t._v(" "),a("th",[t._v("Dictionary 终端")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Moonbeam")]),t._v(" "),a("td",[a("em",[t._v("即将上线")])]),t._v(" "),a("td",[a("em",[t._v("即将上线")])])]),t._v(" "),a("tr",[a("td",[t._v("Moonriver")]),t._v(" "),a("td",[a("code",[t._v("wss://moonriver.api.onfinality.io/public-ws")])]),t._v(" "),a("td",[a("code",[t._v("https://api.subquery.network/sq/subquery/moonriver-dictionary")])])]),t._v(" "),a("tr",[a("td",[t._v("Moonbase Alpha")]),t._v(" "),a("td",[a("code",[t._v("wss://moonbeam-alpha.api.onfinality.io/public-ws")])]),t._v(" "),a("td",[a("code",[t._v("https://api.subquery.network/sq/subquery/moonbase-alpha-dictionary")])])])])]),t._v(" "),a("p",[a("strong",[t._v("您也可以通过事件和调用处理程序来参考 "),a("a",{attrs:{href:"https://github.com/subquery/tutorials-moonriver-evm-starter",target:"_blank",rel:"noopener noreferrer"}},[t._v("基本Moonrier EVM 示例项目"),a("OutboundLink")],1)]),t._v(" 这个项目也存在于 "),a("a",{attrs:{href:"https://explorer.subquery.network/subquery/subquery/moonriver-evm-starter-project",target:"_blank",rel:"noopener noreferrer"}},[t._v(" SubQuery Explorer"),a("OutboundLink")],1),t._v(" 中。")]),t._v(" "),a("h2",{attrs:{id:"快速入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速入门"}},[t._v("#")]),t._v(" 快速入门")]),t._v(" "),a("ol",[a("li",[t._v("添加自定义数据源作为依赖项 "),a("code",[t._v("yarn add @subql/contract-processors")])]),t._v(" "),a("li",[t._v("添加自定义数据源，如下文所述。")]),t._v(" "),a("li",[t._v("将自定义数据源的处理程序添加到您的代码")])]),t._v(" "),a("h2",{attrs:{id:"数据源说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据源说明"}},[t._v("#")]),t._v(" 数据源说明")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("必填")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("processor.file")]),t._v(" "),a("td",[a("code",[t._v("'./node_modules/@subql/contract-processors/dist/moonbeam.js'")])]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("File reference to the data processor code")])]),t._v(" "),a("tr",[a("td",[t._v("processor.options")]),t._v(" "),a("td",[a("a",{attrs:{href:"#processor-options"}},[t._v("ProcessorOptions")])]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("Options specific to the Moonbeam Processor")])]),t._v(" "),a("tr",[a("td",[t._v("assets")]),t._v(" "),a("td",[a("code",[t._v("{ [key: String]: { file: String }}")])]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("An object of external asset files")])])])]),t._v(" "),a("h3",{attrs:{id:"处理器选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理器选项"}},[t._v("#")]),t._v(" 处理器选项：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("必填")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("abi")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("The ABI that is used by the processor to parse arguments. MUST be a key of "),a("code",[t._v("assets")])])]),t._v(" "),a("tr",[a("td",[t._v("address")]),t._v(" "),a("td",[t._v("String or "),a("code",[t._v("null")])]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("A contract address where the event is from or call is made to. "),a("code",[t._v("null")]),t._v(" will capture contract creation calls")])])])]),t._v(" "),a("h2",{attrs:{id:"moonbeamcall"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#moonbeamcall"}},[t._v("#")]),t._v(" MoonbeamCall")]),t._v(" "),a("p",[t._v("使用 "),a("RouterLink",{attrs:{to:"/zh/create/mapping/#call-handler"}},[t._v("Substrate/CallHandler")]),t._v(" 的同样方式，区别是不同的处理程序参数和较小的过滤更改。")],1),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性")]),t._v(" "),a("th",[t._v("类型:")]),t._v(" "),a("th",[t._v("必填")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("kind")]),t._v(" "),a("td",[t._v("'substrate/MoonbeamCall'")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("Specifies that this is an Call type handler")])]),t._v(" "),a("tr",[a("td",[t._v("filter")]),t._v(" "),a("td",[a("a",{attrs:{href:"#call-filters"}},[t._v("Call Filter")])]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("Filter the data source to execute")])])])]),t._v(" "),a("h3",{attrs:{id:"调用过滤器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#调用过滤器"}},[t._v("#")]),t._v(" 调用过滤器")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性")]),t._v(" "),a("th",[t._v("类型:")]),t._v(" "),a("th",[t._v("示例")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("function")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("0x095ea7b3, approve(address to,uint256 value)")]),t._v(" "),a("td",[t._v("Either "),a("a",{attrs:{href:"https://docs.ethers.io/v5/api/utils/abi/fragments/#FunctionFragment",target:"_blank",rel:"noopener noreferrer"}},[t._v("Function Signature"),a("OutboundLink")],1),t._v(" strings or the function "),a("code",[t._v("sighash")]),t._v(" to filter the function called on the contract")])]),t._v(" "),a("tr",[a("td",[t._v("from")]),t._v(" "),a("td",[t._v("String")]),t._v(" "),a("td",[t._v("0x6bd193ee6d2104f14f94e2ca6efefae561a4334b")]),t._v(" "),a("td",[t._v("An Ethereum address that sent the transaction")])])])]),t._v(" "),a("h3",{attrs:{id:"处理程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理程序"}},[t._v("#")]),t._v(" 处理程序")]),t._v(" "),a("p",[t._v("与正常处理程序不同的是，你不会获得一个 "),a("code",[t._v("SubstrateExtrinsic")]),t._v(" 作为参数， 相反，您将得到一个 "),a("code",[t._v("MoonbeamCall")]),t._v(" 基于Ethers "),a("a",{attrs:{href:"https://docs.ethers.io/v5/api/providers/types/#providers-TransactionResponse",target:"_blank",rel:"noopener noreferrer"}},[t._v("交易响应"),a("OutboundLink")],1),t._v(" 类型。")]),t._v(" "),a("p",[t._v("从 "),a("code",[t._v("TransactionResponse")]),t._v(" 类型的更改：")]),t._v(" "),a("ul",[a("li",[t._v("它没有 "),a("code",[t._v("等待")]),t._v(" 和 "),a("code",[t._v("确认")]),t._v(" 属性")]),t._v(" "),a("li",[t._v("如果交易成功将会添加一个 "),a("code",[t._v("成功")]),t._v(" 属性")]),t._v(" "),a("li",[t._v("在 "),a("code",[t._v("abi")]),t._v(" 字段提供参数使其可以成功分析时将会添加"),a("code",[t._v("args")]),t._v(" 字段")])]),t._v(" "),a("h2",{attrs:{id:"moonbeam-事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#moonbeam-事件"}},[t._v("#")]),t._v(" Moonbeam 事件")]),t._v(" "),a("p",[t._v("使用 "),a("RouterLink",{attrs:{to:"/zh/create/mapping/#event-handler"}},[t._v("Substrate/CallHandler")]),t._v(" 的同样方式，区别是不同的处理程序参数和较小的过滤更改。")],1),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("必填")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("kind")]),t._v(" "),a("td",[t._v("'substrate/MoonbeamEvent'")]),t._v(" "),a("td",[t._v("Yes")]),t._v(" "),a("td",[t._v("Specifies that this is an Event type handler")])]),t._v(" "),a("tr",[a("td",[t._v("filter")]),t._v(" "),a("td",[a("a",{attrs:{href:"#event-filters"}},[t._v("Event Filter")])]),t._v(" "),a("td",[t._v("No")]),t._v(" "),a("td",[t._v("Filter the data source to execute")])])])]),t._v(" "),a("h3",{attrs:{id:"event-过滤器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#event-过滤器"}},[t._v("#")]),t._v(" Event 过滤器")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("属性")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("示例")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("topics")]),t._v(" "),a("td",[t._v("String array")]),t._v(" "),a("td",[t._v("Transfer(address indexed from,address indexed to,uint256 value)")]),t._v(" "),a("td",[t._v("The topics filter follows the Ethereum JSON-PRC log filters, more documentation can be found "),a("a",{attrs:{href:"https://docs.ethers.io/v5/concepts/events/",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(".")])])])]),t._v(" "),a("p",[a("b",[t._v("关于主题的说明：")]),t._v("\n基本日志过滤器有一些改进：")]),t._v(" "),a("ul",[a("li",[t._v("主题不需要为 0 padded")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://docs.ethers.io/v5/api/utils/abi/fragments/#EventFragment",target:"_blank",rel:"noopener noreferrer"}},[t._v("事件片段"),a("OutboundLink")],1),t._v(" 字符串可以提供并自动转换为他们的 id")])]),t._v(" "),a("h3",{attrs:{id:"处理程序-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#处理程序-2"}},[t._v("#")]),t._v(" 处理程序")]),t._v(" "),a("p",[t._v("与正常处理程序不同的是，你不会获得一个 "),a("code",[t._v("SubstrateExtrinsic")]),t._v(" 作为参数， 相反，您将得到一个 "),a("code",[t._v("MoonbeamEvent")]),t._v(" 基于Ethers "),a("a",{attrs:{href:"https://docs.ethers.io/v5/api/providers/types/#providers-Log",target:"_blank",rel:"noopener noreferrer"}},[t._v("Log"),a("OutboundLink")],1),t._v(" 类型。")]),t._v(" "),a("p",[t._v("来自 "),a("code",[t._v("Log")]),t._v(" 类型的更改：")]),t._v(" "),a("ul",[a("li",[t._v("在 "),a("code",[t._v("abi")]),t._v(" 字段提供参数使其可以成功分析时将会添加"),a("code",[t._v("args")]),t._v(" 字段")])]),t._v(" "),a("h2",{attrs:{id:"数据源示例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据源示例"}},[t._v("#")]),t._v(" 数据源示例")]),t._v(" "),a("p",[t._v("这是从 "),a("code",[t._v("project.yaml")]),t._v(" 清单文件中提取出的。")]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dataSources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" substrate/Moonbeam\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("startBlock")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("752073")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("processor")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./node_modules/@subql/contract-processors/dist/moonbeam.js'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Must be a key of assets")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("abi")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" erc20\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Contract address (or recipient if transfer) to filter, if `null` should be for contract creation")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("address")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0x6bd193ee6d2104f14f94e2ca6efefae561a4334b'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("assets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("erc20")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./erc20.abi.json'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./dist/index.js'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("handlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" handleMoonriverEvent\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" substrate/MoonbeamEvent\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("topics")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Transfer(address indexed from"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("address indexed to"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("uint256 value)\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" handleMoonriverCall\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" substrate/MoonbeamCall\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## The function can either be the function fragment or signature")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# function: '0x095ea7b3'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# function: '0x7ff36ab500000000000000000000000000000000000000000000000000000000'")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# function: approve(address,uint256)")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" approve(address to"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("uint256 value)\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("from")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'0x6bd193ee6d2104f14f94e2ca6efefae561a4334b'")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br")])]),a("h2",{attrs:{id:"已知问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#已知问题"}},[t._v("#")]),t._v(" 已知问题")]),t._v(" "),a("ul",[a("li",[t._v("目前无法在处理程序中查询 EVM 状态")]),t._v(" "),a("li",[t._v("无法通过调用处理程序来获取交易收据信息")]),t._v(" "),a("li",[a("code",[t._v("blockHash")]),t._v(" 属性当前未定义。 "),a("code",[t._v("blockNumber")]),t._v(" 属性可以改为使用")])])])}),[],!1,null,null,null);e.default=r.exports}}]);