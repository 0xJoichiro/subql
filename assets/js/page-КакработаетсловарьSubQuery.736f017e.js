(window.webpackJsonp=window.webpackJsonp||[]).push([[175],{726:function(t,e,r){"use strict";r.r(e);var s=r(1),a=Object(s.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"как-работает-словарь-subquery"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#как-работает-словарь-subquery"}},[t._v("#")]),t._v(" Как работает словарь SubQuery?")]),t._v(" "),r("p",[t._v("Вся идея проекта универсального словаря состоит в том, чтобы индексировать все данные из цепочки блоков и записывать события, внешние данные и их типы (модуль и метод) в базу данных в порядке высоты блока. Затем другой проект может запросить эту конечную точку "),r("code",[t._v("network.dictionary")]),t._v(" вместо значения по умолчанию "),r("code",[t._v("network.endpoint")]),t._v(", определенного в файле манифеста.")]),t._v(" "),r("p",[t._v("Конечная точка "),r("code",[t._v("network.dictionary")]),t._v(" - это необязательный параметр, который, если он присутствует, SDK автоматически обнаружит и использует. "),r("code",[t._v("network.endpoint")]),t._v(" является обязательным и не будет компилироваться, если он отсутствует.")]),t._v(" "),r("p",[t._v("Взяв в качестве примера проект "),r("a",{attrs:{href:"https://github.com/subquery/subql-dictionary",target:"_blank",rel:"noopener noreferrer"}},[t._v(" SubQuery dictionary "),r("OutboundLink")],1),t._v(", файл "),r("a",{attrs:{href:"https://github.com/subquery/subql-dictionary/blob/main/schema.graphql",target:"_blank",rel:"noopener noreferrer"}},[t._v(" schema "),r("OutboundLink")],1),t._v(" определяет 3 объекта; внешние, события, specVersion. Эти 3 объекта содержат 6, 4 и 2 поля соответственно. При запуске этого проекта эти поля отражаются в таблицах базы данных.")]),t._v(" "),r("p",[r("img",{attrs:{src:"/assets/img/extrinsics_table.png",alt:"extrinsics table"}}),t._v(" "),r("img",{attrs:{src:"/assets/img/events_table.png",alt:"events table"}}),t._v(" "),r("img",{attrs:{src:"/assets/img/specversion_table.png",alt:"specversion table"}})]),t._v(" "),r("p",[t._v("Затем данные из цепочки блоков сохраняются в этих таблицах и индексируются для повышения производительности. Затем проект размещается в проектах SubQuery, и конечная точка API доступна для добавления в файл манифеста.")]),t._v(" "),r("h2",{attrs:{id:"как-включить-словарь-в-свои-проект"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#как-включить-словарь-в-свои-проект"}},[t._v("#")]),t._v(" Как включить словарь в свой проект?")]),t._v(" "),r("p",[t._v("Добавьте "),r("code",[t._v("dictionary: https://api.subquery.network/sq/subquery/dictionary-polkadot")]),t._v(" в сетевой раздел манифеста. Например:")]),t._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[t._v("network:\n  endpoint: wss://polkadot.api.onfinality.io/public-ws\n  dictionary: https://api.subquery.network/sq/subquery/dictionary-polkadot\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br"),r("span",{staticClass:"line-number"},[t._v("2")]),r("br"),r("span",{staticClass:"line-number"},[t._v("3")]),r("br")])]),r("h2",{attrs:{id:"что-происходит-если-словарь-не-используется"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#что-происходит-если-словарь-не-используется"}},[t._v("#")]),t._v(" Что происходит, если словарь НЕ используется?")]),t._v(" "),r("p",[t._v("Когда словарь НЕ используется, индексатор будет извлекать данные каждого блока через api polkadot в соответствии с флагом "),r("code",[t._v("batch-size")]),t._v(", который по умолчанию равен 100, и помещает их в буфер для обработки. Позже индексатор берет все эти блоки из буфера и при обработке данных блока проверяет, соответствуют ли событие и внешний вид в этих блоках заданному пользователем фильтру.")]),t._v(" "),r("h2",{attrs:{id:"что-происходит-когда-словарь-используется"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#что-происходит-когда-словарь-используется"}},[t._v("#")]),t._v(" Что происходит, когда словарь используется?")]),t._v(" "),r("p",[t._v("Когда используется словарь, индексатор сначала принимает фильтры вызовов и событий в качестве параметров и объединяет их в запрос GraphQL. Затем он использует API словаря для получения списка только соответствующих высот блоков, который содержит конкретные события и внешние элементы. Часто это существенно меньше 100, если используется значение по умолчанию.")]),t._v(" "),r("p",[t._v("Например, представьте себе ситуацию, когда вы индексируете события передачи. Не все блоки имеют это событие (на изображении ниже нет событий передачи в блоках 3 и 4).")]),t._v(" "),r("p",[r("img",{attrs:{src:"/assets/img/dictionary_blocks.png",alt:"dictionary block"}})]),t._v(" "),r("p",[t._v("Словарь позволяет вашему проекту пропустить это, поэтому вместо того, чтобы искать в каждом блоке событие передачи, он пропускает только блоки 1, 2 и 5. Это потому, что словарь является предварительно вычисленной ссылкой на все вызовы и события в каждом блоке.")]),t._v(" "),r("p",[t._v("Это означает, что использование словаря может уменьшить объем данных, которые индексатор получает из цепочки, и уменьшить количество «нежелательных» блоков, хранящихся в локальном буфере. Но по сравнению с традиционным методом он добавляет дополнительный шаг для получения данных из API словаря.")]),t._v(" "),r("h2",{attrs:{id:"когда-словарь-не-полезен"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#когда-словарь-не-полезен"}},[t._v("#")]),t._v(" Когда словарь НЕ полезен?")]),t._v(" "),r("p",[t._v("Когда "),r("a",{attrs:{href:"https://doc.subquery.network/create/mapping.html#block-handler",target:"_blank",rel:"noopener noreferrer"}},[t._v(" обработчики блоков "),r("OutboundLink")],1),t._v(" используются для захвата данных из цепочки, каждый блок должен быть обработан. Следовательно, использование словаря в этом случае не дает никаких преимуществ, и индексатор автоматически переключится на не словарный подход по умолчанию.")]),t._v(" "),r("p",[t._v("Кроме того, при работе с событиями или внешними событиями, которые происходят или существуют в каждом блоке, таком как "),r("code",[t._v("timestamp.set")]),t._v(", использование словаря не даст никаких дополнительных преимуществ.")])])}),[],!1,null,null,null);e.default=a.exports}}]);